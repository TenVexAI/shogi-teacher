# 詰将棋ソフト「脊尾詰」将棋所対応版

1997年に最長手数の詰将棋「ミクロコスモス」(1525手詰）をコンピュータソフトとして初めて解き、
一世を風靡したあと、しばらく化石となってしまっていた「脊尾詰」が復活。
Windows版の将棋GUIソフトとして広く使われている「将棋所」に今回対応しました。
思考アルゴリズムは、かつての脊尾詰シリーズの最新版「脊尾四」に相当します。


## 動作環境

将棋所が動作する環境であれば、動作するはずです。
http://www.geocities.jp/shogidokoro/environment.html


## 使用承諾条件

・脊尾詰(SeoTsume)の著作権は脊尾詰の作者が保有します。
・脊尾詰を使用したことによるいかなる損害に対しても、作者は責任を負いません。
・脊尾詰は無償で提供されますが、何の欠陥もないという無制限の保証を行うものではありません。
・脊尾詰に関する不具合や質問等のお問い合わせは、原則お受けできません。
・脊尾詰をいかなる形式、いかなる手段によっても、販売・再配布することを禁じます。


## 使い方

 1. 将棋所をあらかじめパソコンにインストールしておきます。 
　　- 将棋所 http://www.geocities.jp/shogidokoro/

 2. 脊尾詰のzipファイルを任意のフォルダに解凍します。 

 3. 将棋所を起動します。 

 4. 将棋所に脊尾詰の実行ファイル（SeoTsume.exe）を登録します。 

 5. ハッシュメモリのサイズを指定します。
    ・1997年にミクロコスモスを解いたときのサイズは224MBです。
    　大概の詰将棋はこれで十分ですが、もっと難解な問題を解きたい場合は
    　パソコンの搭載メモリを確認したうえでさらに値を増やすと良いです。 

 6. 余詰の確認を実行する場合は、脊尾詰のオプションを設定します。
　　詰将棋創作以外の用途では設定不要と思います。
　　・「Do_YoTsume_Search」：本手順を検出した後、引き続き余詰の検索をするかどうか設定します。
　　・「YoTsume_Second」：余詰検索の実行時間（1秒～3600秒）を秒単位で設定します。 

 7. 設定の方法など、詳しい使い方については、将棋所の使い方ページをご覧ください。 
　　- 将棋所の使い方 http://www.geocities.jp/shogidokoro/usage.html

 8. 余詰検索をしない場合は、詰手順が１つ見つかるとただちにそれを解答して終了します。
　　・思考アルゴリズムの性質上、最短手数で詰めることが保証されないため、
　　　迂回手順や変化別詰（＝作意より長い手順）を解答してしまう場合がありますことを
　　　ご了承ください。（変化別詰の場合は、残念ながら余詰検索の効果がなくなります。）

 9. 余詰検索をする場合は、最初に見つけた詰手順をベースとして、
　　この手順から分岐する別の詰手順を「YoTsume_Second」で設定した時間の間、
　　最大２０通りまで検出して表示します。 

10. 余詰検索の終了時には、最初に見つけた詰手順を本解答として出力しますが、
　　途中で中断を押した場合は詰手順が出力されませんのでご注意ください。
　　また迂回手順や非限定手順など、本来余詰ではなくキズとして扱われる手順を
　　余詰として指摘する場合があることをご了承ください。 


## 変更履歴

2017/05/20  1.2
【速度改善】
  ・指し手生成部の効率化で、NPS(１秒あたりの探索局面数)を約１割向上。
【不具合対応】
　・解答手順が詰め上がりの前に途切れる不具合。（例：図巧第100番「寿」）
　・詰む局面を詰まないと誤答してしまう不具合。<depth>値が大きくなる問題
　　にて発生。（例：吉田京平氏 半期賞受賞作 233手詰）
　・双玉問題で、歩合による先手玉への打歩詰が発生する局面で、歩以外の合駒を
　　見落として、詰まない局面を詰みと誤答する不具合。（例：自作のテスト問題）
　・１秒以内に不詰を解答した場合に、探索局面数等の数値が表示されない。

2017/03/26  1.1
  ・ハッシュメモリの使用効率を改善。
　　ハッシュ使用率が80%を超えるケースで、従来より早く解ける場合があります。
　・seldepth で現在読んでいる局面の深さを表示。
　　<depth> / <seldepth> にて、
　　　depth : 探索の進行具合を表し、大きくなる程、詰まない可能性が高まります。
　　　seldepth : 単純に、何手先の局面を現在読んでいるのかを表します。
　・余詰検索のときの「YoTsume_Second」への対応に誤りがあり、修正。

2017/03/14  1.0
  ・将棋所GUIへの対応　初版


## 謝辞

将棋所GUIへの対応にあたり、Lesserkaiのサンプルコードがたいへん参考になりました。
また1990年代から「脊尾詰」の進化にご協力いただいた皆様、遅れ馳せながらありがとうございました。
この場をお借りして、心より御礼申し上げます。

「脊尾詰」開発者  脊尾昌宏
